{% extends 'base.html' %}

{% block meta %}
<title>{{ product.name }}</title>


      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
{% endblock meta %}

{% block content %}
<div class="flex flex-col items-center mx-auto product-details md:flex-row md:items-start">
    {% if product.image_url %}
        <img src="{{ product.image_url }}" alt="{{ product.name }}" class="product-image">
    {% endif %}
    <div class="mt-6 ml-0 product-info md:ml-6 md:mt-0">
        <h1 style="text-align: center"><strong>{{ product.name }}</strong></h1>
        <p><strong>Price:</strong> {{ product.price }}</p>
        <p><strong>Stock:</strong> {{ product.stock }}</p>
        <p><strong>Category:</strong> {{ product.category }}</p>
        <p><strong>Description:</strong> {{ product.description }}</p>
        <div class="gap-10 button-container">
            <a href="{% url 'reviews:product_reviews' product.id %}">
                <button 
                    onclick="addToCart({{ product.id }}, {{ product.stock }})"
                    class="px-6 py-2 font-bold text-white rounded add-to-cart-button bg-accent hover:bg-amber-90">
                    Check Reviews
                </button>
            </a>
            <a href="/carts">
                <button 
                    onclick="addToCart({{ product.id }}, {{ product.stock }})"
                    class="px-6 py-2 font-bold text-white rounded add-to-cart-button bg-accent hover:bg-amber-90">
                    Add to Cart
                </button>
            </a>
        </div>
        <a href="{% url 'products:show_products' %}">
            <input type="button" value="Back" class="px-6 py-2 font-bold text-white bg-gray-500 rounded hover:bg-gray-600">
        </a>
    </div>
</div>

<style>
    .product-details {
        border: 1px solid #ddd;
        padding: 20px;
        border-radius: 5px;
        max-width: 800px;
        margin: auto;
        display: flex;
        gap: 20px;
        align-items: flex-start;
    }
    .product-image {
        max-width: 300px;
        height: auto;
        border-radius: 5px;
    }
    .product-info {
        flex-grow: 1;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .button-container {
        display: flex;
        justify-content: center; 
        margin-top: 10px; 
    }
    .add-to-cart-button {
        background-color: wheat; 
        color: white; 
        border: none; 
        border-radius: 10px; 
        padding: 10px 20px; 
        cursor: pointer; 
        font-size: 16px; 
        transition: background-color 0.3s; 
    }
    .add-to-cart-button:hover {
        background-color: #5C4033; 
    }
</style>


<script>
  function addToCart(productId, stock) {
    if (stock === 0) {
      alert("This item is out of stock.");
      return;
    }
    
    fetch("{% url 'carts:add_to_cart' %}", {
      method: 'POST',
      body: new URLSearchParams({ product_id: productId }),
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
    })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        alert("Product successfully added to cart.");
      } else {
        alert(`Error: ${data.message}`);
      }
    });
  }
</script>
{% endblock content %}
